<script type="module">
    import {Crypto} from "./dist/api.js"

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    // By default, JS SDK uses in-memory persister.
    // *****WARNING*****: DO NOT USE LocalStoragePersister for any purpose other than testing locally on browser.
    let persister = null;
    const c = new Crypto("insert-your-api-key-here", persister);
    await c.register();

    // uncomment this to test key rotation works in sync
    // e.g. change crypto config key on admin portal
    // await sleep(20000);
    await c.sync();

    let encrypted = await c.encrypt("Hello!", "default");
    console.log(encrypted);
    encrypted.get(async e => {
        let decrypted = await c.decrypt(e);
        decrypted.get(d => console.log(d));
    });

    let signed = await c.signOnly("SIGNME");
    console.log(signed);
    signed.get(async e => {
        let verified = await c.verifyOnly(e);
        verified.get(d => console.log(d));
    });
</script>
